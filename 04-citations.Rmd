# Análise de séries temporais

Qualquer conjunto de observações ordenadas no tempo são chamadas de Séries Temporais. No caso da Engenharia Ambiental e Urbana, podem ser citados alguns exemplos: valores diários de poluição, valores mensais de temperatura, temperaturas máximas e mínimas diárias ou precipitação atmosférica anual em uma cidade, entre outros (Morettin, 2018). 

É suposto que, em uma análise de série temporal, "*há um sistema causal mais ou menos constante, relacionado com o tempo, que exerceu influência sobre os dados no passado e pode continuar a fazê-lo no futuro. Este sistema causal costuma atuar criando padrões não aleatórios que podem ser detectados em um gráfico da série temporal, ou mediante algum outro processo estatístico*" (REIS, 2022).

É importante citar que identificar esses padrões não aleatórios na série temporal de uma variável de interesse é o objetivo da análise. A partir dessa identificação, é possível realizar previsões, orientando tomadas de decisões na área de interesse (REIS, 2022).

A partir de procedimentos estatísticos, é possível realizar a análise da série de dados de forma que seja possível realizar previsões, analisar causalidades e estudar periodicidades relevantes. Conforme COSTA (2022) e SOARES (2020), em resumo, nas séries temporais caracterizam-se por:

  1. Possuirem variáveis aleatórias;
  2. Observações altamente correlacionadas, principalmente porque medidas adjacentes (próximas no tempo) tendem a correlatas;
  3. Existência de fatores determinísticos, como tendência, sazonalidade e ciclos;
  4. Dificuldade em lidar com outliers;
  5. Mudanças fundamentais/abruptas.

De acordo com Reis (2022) e Barros et. al (2022), séries temporais são compostas pelos seguintes padrões:

1) **Tendência (T)**: série temporal que segue determinada direção, não necessariamente linear, podendo também ser crescente ou decrescente. Exemplos podem ser: crescimento demográfico, ou mudança gradual de hábitos de consumo, ou qualquer outro aspecto que afete a variável de interesse no longo prazo;

2) **Variações cíclicas ou ciclos (C)**, flutuações nos valores da variável com duração superior a um ano, e que se repetem com certa periodicidade, que podem ser resultado de variações da economia como períodos de crescimento ou recessão, ou fenômenos climáticos como o El Niño (que se repete com periodicidade superior a um ano);

3) **Variações sazonais ou sazonalidade (S)**, flutuações nos valores da variável com duração inferior a um ano, e que se repetem todos os anos, geralmente em função das estações do ano (ou em função de feriados ou festas populares, ou por exigências legais, como o período para entrega da declaração de Imposto de Renda); se os dados forem registrados anualmente NÃO haverá influência da sazonalidade na série;

4) **Variações irregulares (I)**, que são as flutuações inexplicáveis, resultado de fatos inesperados como catástrofes naturais, decisões intempestivas de governos, etc.

Estes são estudados para controlar o efeito de cada componente a fim de analisar o comportamento de cada "série filtrada" e, ainda, analisar as particularidades de cada componente (COSTA, 2022).

```{r figura 3.1, fig.cap="Figura 3.1: Séries exibindo diferentes tipos de padrões (Fonte: BARROS et. al, 2022)"} 


knitr::include_graphics("Figuras/Fig4_1.jpg")

```
De acordo com COSTA (2022), existem duas abordagens na análise de séries temporais:

  1. **Clássica**: descreve o comportamento da série por meio de componentes não observáveis, ou seja, a tendência, sazonalidade e ciclo. Os desvios em torno dos valores determinísticos^[Em um modelo determinístico, indepentemente dos conjuntos de entrada, o resultado será sempre o mesmo conjunto de saídas.] ocorrem por erros aleatórios e não pela natureza estocástica da série.
  
  
  2. **Moderna**: supões que a série temporal seja formada por um processo estocástico^[Processo estocástico: sequência de variáveis aleatórias cujas características probabilísticas não se alteram ao longo do tempo. Exemplo: No lançamento de dados cada face tem a mesma probabilidade de ficar para cima]. Sendo cada observação composta por um conjunto de variáveis aleatórias, estas são representadas por funções de densidade individuais. Para capturar sua característica estocástica, são utilizadas modelos estatísticos.

## Estacionaridade
Para realizar a abordagem de séries temporais assume-se que esta seja formada por um processo estocástico, como citado anteriormente. De forma resumida, uma série estacionária possui a mesma distribuição de probabilidade para cada observação.

A estacionaridade divide-se em: forte, em que a função densidade de probabilidade não varia no tempo e as distribuição são iguais para todo $t$; fraca, em que a média, variância e covariância permanecem constantes ao longo do tempo. A estacionaridade fraca é menos restritiva que a forte e, por isso, será a abordagem escolhida.

Uma série fracamente estacionária tem as seguintes características:

1. A média é igual a uma constante
2. A variância é constante e finita;
3. A covariância é dependente somente da diferença no tempo (h) entre duas medidas, sendo a covariância:

$$\tag{4.3}Cov(X_t,X_{t+h})=\sum(X_t-\overline{X_t})(X_{t+h}-\overline{X_{t+h}})$$, em que $X_t$ é a própria série temporal e $h$ é o intervalo de tempo entre as duas medidas.

Dessa forma, quando a covariância é positiva, a tendência é positiva entre $X_t$ e $X_{t+h}$. Quando a covariância é negativa, a tendência também é negativa. Se a covariância for nula, não existe tendência.

É importante citar que se uma série não for estacionária, modelos padrões podem não representar de forma adequada o processo gerador da série temporal e, por isso, não seria possível utilizar o modelo para realizar previsões ou outros objetivos da análise. Conforme o Teorema de Wald, a estacionariedade dá estabilidade e coerência ao modelo.

## Modelos univariados para séries temporais

De acordo com Barros et. al (2022), uma série temporal pode ser representada por um modelo aditivo ou multiplicativo. No modelo aditivo, todas as componentes tem a mesma unidade da série; já no multiplicativo, somente a tendência tem a mesma unidade da variável e todas as outras componentes assumem valor próximos de 1 (Reis, 2022).

$$ \tag{4.1} Z_t=T_t+S_t+E_t$$ $$ou$$ $$ \tag{4.2}Z_t=T_t*S_t*E_t$$

### Suavização exponencial simples (SES)
O SES é um modelo mais adequado para previsão de séries temporais livres das componentes tendência (T) e sazonalidade (S). Portanto, a estratégia é identificar e remover esses componentes da série, a tornando uma série estacionária.

Este modelo é descrito da seguinte forma:
$$\tag{4.2}\overline{Z_t}=\alpha Z_t+\alpha(1-\alpha)Z_{t-1}+\alpha(1-\alpha)^2Z_{t-2}+...$$, onde $\overline{Z_0}=Z_1, t=1,...,N$.

O $\alpha$ representa o parâmetro de suavização com valores de 0 a 1 e quanto mais estável for a previsão, menor o valor de $alpha$ porque as observações passadas terão pesos maiores do que teriam com um $alpha$ grande. Quanto mais próximo de 1, menor amortecimento e $\overline{Z_t}$ é aproximadamente igual a $Z_t$ (COSTA, 2022). Para aplicar o método em R, utiliza-se a função `HoltWinters()`, sendo x a série temporal de interesse e alpha o parâmetro de suavização. Os parâmetros beta e gamma são descritos como "FALSE".

Conforme (COSTA, 2022), a previsão de obervações futuras para o modelo SES consite em:
$$\tag{4.3a}\widehat{Z_t}=\overline{Z_t}, \forall h>0$$
$$\tag{4.3b}\widehat{Z_t}=\alpha Z_t+\alpha(1-\alpha)Z_{t-1}(h+1)$$, sendo $h$ o número de passos à frente do previsto. Para realizar previsões em R, utiliza-se a função `forecast()` do pacote forecast, em que objeject é um objeto de classe "HoltWinters", h é o número de períodos a serem previstos e level é o intervalo de confiança para a predição.

É importante citar que o modelo SES não é apropriado para séries com tendência linear, porque acarretaria em previsões que subestimariam ou superestimariam os valores da série temporal.

### Suavização exponencial de Holt (SEH)
O modelo SEH possui um parâmetro de suavização para trabalhar com a tendência da série temporal e, dessa forma, é possível realizar previsões em séries que apresentam o efeito de tendência linear. O modelo é estimado por:
$$\tag{4.4} L_t=(1-\alpha)(L_{t-1}+T_{t-1}), 0\le\alpha\le1; t=2,...N$$
$$\tag{4.5}T_t=\beta(L_t-L_{t-1})+(1-\beta)T_{t-1}, 0\le\beta\le1; t=2,...N$$
em que $L_t$ estima o nível da série no tempo t, $t_t$ estima a tendência no tempo t e $\alpha$ e $\beta$ são os parâmetros de suavisão para o nível e tendência, respectivamente. Para representar o modelo, também é utilizada a função `HoltWinters()`. Nesse caso, o argumento $gamma$ será descrito como "FALSE", já que o modelo utiliza somente os argumentos $\alpha$ e $\beta$.

A previsão ($Z_{t+h}$) é dada por:
$$\tag{4.6}\widehat{Z_h}=h\widehat{T_t}, \forall h>0$$
Para a previsão, também utiliza-se a função `forecast()`. 

### Suavização exponencial sazonal de Holt-Winters
Para séries temporais que apresental comportamento sazonal, o modelo de Holt-Winters (HW) é o mais indicado. Nesse caso, existe uma equação adicional para a sazonalidade. Existem dois métodos de análise:

#### Modelo aditivo
Se a componente sazonal for tratada de forma aditiva, o modelo será:
$$\tag{4.7}L_t=\alpha(Z_t-S_{t-m})+(1-\alpha)(L_{t-1}+T_{t-1}, 0\le\alpha\le1, t=m+1,...,N$$
$$\tag{4.8}T_t=\beta(L_t-L_{t-1})+(1-\beta)T_{t-1}, 0\le\beta\le1, t=m+1,...,N$$
$$\tag{4.9}S_t=\gamma(Z_t-L_{t-1}-T_{t-1})+(1-\gamma)S_{t-m}, 0\le\gamma\le1, t=m+1,...,N$$
, onde $\alpha, \beta$ e $\gamma$ são os parâmetros de suavização para o nível, tendência e sazonalidade respectivamente.
O modelo de previsão h passos à frente é representado por:
$$\tag{4.10}\widehat{Z_{t+h}}=L_t+T_th+S_{t+h-m}$$

#### Modelo multiplicativo
Seguindo o mesmo raciocínio anterior, o modelo é dado por:
$$\tag{4.11}L_t=\alpha(\frac{Z_t}{S_{t-m}})+(1-\alpha)(L_{t-1}+T_{t-1}, 0\le\alpha\le1, t=m+1,...,N$$
$$\tag{4.12}T_t=\beta(L_t-L_{t-1})+(1-\beta)T_{t-1}, 0\le\beta\le1, t=m+1,...,N$$
$$\tag{4.13}S_t=\gamma(\frac{Z_t}{L_{t-1}-T_{t-1}})+(1-\gamma)S_{t-m}, 0\le\gamma\le1, t=m+1,...,N$$
E, para a previsão:
$$\tag{4.14}\widehat{Z_{t+h}}=(L_t+T_th)S_{t+h-m}$$
### Modelos SARIMA
Um modelo ARIMA (Modelos autoregressivos integrados de médias móveis), a partir da abordagem de Box & Jenkins, permite que previsões sejam realizadas tomando por base valores presentes e passados da série temporal. Quando considerada a sazonalidade, o modelo é denominado SARIMA $(p,d,q)(P,D,Q)_s$, representado pela equação 4.15.
$$\tag{4.15}\phi(L)\Phi(L)\Delta^d\Delta^Dy_t=\theta(L)\Theta(L)\epsilon_t$$, em que:

p: ordem do polinômio autoregressivo não sazonal $\phi(L)$
P: orgem do polinômio autoregressivo sazonal $\Phi(L)$
q: ordem do polinômio de médias móveis não sazonal $\theta(L)$
Q: ordem do polinômio de médias móveis sazonal $\Theta(L)$
d: ordem de diferença não sazonal
D: ordem de diferença sazonal
$\phi(L)=(1-\phi_1L-\phi_2L^2-...-\phi_pL^p$
$\Phi(L)=(1-\Phi_1L^s-\Phi_2L^{2s}-...-\Phi_pL^{Ps})$
$\theta(L)=(1-\theta_1L-\theta_2L^2-...-\theta_pL^q)$
$\Theta(L)=(1-\Theta_1L^2-\Theta_2L^{2s}-\Theta_pL^{Qs})$
$\Delta-=1-L$, sendo o operador de desafasagem (L): $L^ny_t=y_{t-n}$

Conforme Morettin (2018), Na abordagem de Box & Jenkins, existem 4 etapas:
1. Identificação do processo gerador de dados
Para descobrir qual modelo descreve melhor o comportamento dos dados, inicialmente, realiza-se uma análise gráfica, verificando estacionaridade, tendência, sazonalidade, etc. A partir disso...

2. Estimação de parâmetros
Os parâmetros do modelo são identificados e, para isso, utilizam-se critérios de informação (Akaike, bayesiano, Hannan-Quinn...). O modelo mais adequado é o que minimiza os critérios de informação.

3. Verificação do modelo (diagnóstico)
Realiza-se a nálise dos resíduos, na qual:
  a) resíduos devem possuir média zero, variância constante e serem estacionários, comportando-se como um *ruído branco*.
  b) As funções de autocorrelação devem ser não significativas, ou seja, devem ficar dentro do intervalo de confiança.
  c) Homocedasticidade: o gráfico deve ter variância constante
  d) Não correlacionados.
  
4. Previsão




Reference items in your bibliography file(s) using `@key`.

For example, we are using the **bookdown** package [@R-bookdown] (check out the last code chunk in index.Rmd to see how this citation key was added) in this sample book, which was built on top of R Markdown and **knitr** [@xie2015] (this citation was added manually in an external file book.bib). 
Note that the `.bib` files need to be listed in the index.Rmd with the YAML `bibliography` key.


The RStudio Visual Markdown Editor can also make it easier to insert citations: <https://rstudio.github.io/visual-markdown-editing/#/citations>

## Referências Bibliográficas {-}

BARROS, Anna C.; MATTOS, Daiane Marcolino D.; OLIVEIRA, Ingrid Christyne Luquett D.; et al. **Análise de Séries Temporais em R: Curso Introdutório**. Grupo GEN, 2017. 9788595154902. Disponível em: https://integrada.minhabiblioteca.com.br/#/books/9788595154902/. Acesso em: 21 jun. 2022.

MORETTIN, Pedro A. Análise de Séries Temporais. Editora Blucher, 2018. 9788521213529. Disponível em: https://integrada.minhabiblioteca.com.br/#/books/9788521213529/. Acesso em: 10 jun. 2022.

REIS, Marcelo Menezes. Análise de séries temporais. Santa Catarina, UFSC, 2022. Disponível em: <https://www.inf.ufsc.br/~marcelo.menezes.reis/Cap4.pdf> Acesso em: 10 jun. 2022.

SOARES, Thiago Costa. Séries Temporais. Universidade Federal de Juiz de Fora, 2020. Disponível em: <https://www.youtube.com/watch?v=T4N8ZhmiUEM&list=PLW1zGvUGqyiEw1O3HAcjezB9esyI8R8xe&index=5>. Acesso em: 29 jun 2022.

COSTA, Alexandre Cunha. "Introdução à Análise de Séries Temporais". Disponível em: <https://www.youtube.com/watch?v=emnSZ7qKv9M&list=PLSDVadsSlXTCVcg95hQsEOVRnVwgaPTRC&index=1> Acesso em: 27 jun. 2022.