# Modelos lineares

Resumidamente, modelos lineares são utilizados para resumir relações observadas a partir de dados, no caso, ambientais, em uma linha reta. Em um modelo linear descreve-se o comportamento de uma variável dependente (ou variável resposta, y) como função de uma ou mais variáveis independentes (ou variáveis explicativas, x). 

## Covariância
A *Covariância*, denotada $\sigma_{xy}$, descreve a variação, em relação a média, entre duas variáveis. 

$cov(x,y) = \frac{\sum(x_i - \overline{x})}{n-1}$

Portanto, é possível saber se ambas variáveis desviam na mesma direção (covariância positiva) ou se desviam em direções opostas (covariância negativa). Caso a covariância entre duas variáveis seja zero, a conclusão é que as variáveis são independentes. 

```{r fig-3.1, fig.cap="Covariância"}


#knitr::include_graphics("~/UFABC Beatriz/TG Beatriz Lima/Dados/Figuras/Covariancia.png")

```

## Correlação

A **Correlação** é útil para medir a relação linear entre duas variáveis x e y, denotada por $\rho_{xy}$.

$\rho_xy = \frac{cov(x,Y)}{\sqrt(V(x)V(Y))}$

Sendo assim, duas variáveis podem estar relacionadas das seguintes formas:

  1. Positivamente relacionadas. Ou seja, se x aumenta, y aumenta. E o mesmo ocorre para caso X diminua (Y diminui) -  Correlação positiva;
  2. Negativamente relacionadas. Ou seja, se x aumenta, y diminui. E o mesmo ocorre para caso x diminua (Y aumenta) - Correlação negativa;
  3. Não há relação entre as duas variáveis.

```{r fig-3.2, fig.cap="Correlação"}

#knitr::include_graphics("~/UFABC Beatriz/TG Beatriz Lima/Dados/Figuras/Correlação.jpg")

```

Uma forma gráfica de visualizar a correlação das variáveis que apresenta grande utilidade é a partir do **Diagrama de Dispersão**. O diagrama traz informações importantes porque mostra se a relação entre as variáveis é linear ou não, se existem outliers no conjunto de dados e traz uma ideia de quão forte é o relacionamento entre as variáveis.


## Regressão linear simples

A partir da regressão, é possível obter a relação matemática que descreva a relação entre duas ou mais variáveis. A análise de regressão é uma coleção de ferramentas estatísticas que permite a modelagem e inferência de uma variável dependente (y) com uma ou mais variáveis independentes (x). No caso da regressão linear simples, somente existe uma variável independente; para a regressão linear múltipla, mais de uma. Dessa forma, o formato básico do modelo linear resultante é:

$Y = \beta_0 + \beta_1X_1$, sendo $\beta_0$ o coeficiente do intercepto e $\beta_1$ o coeficiente de inclinação
                          
De acordo com Montgomery & Runger (2021), o modelo de regressão é, na verdade, uma linha de valores médios. Ou seja, "*a altura da linha de regressão em qualquer valor de x é apenas o valor esperado de Y para aquele x. O coeficiente angular,* $\beta_1$*, pode ser interpretado como a mudança na média de Y para uma mudança unitária em x. Além disso, a variabilidade de Y, em um valor particular de x, é determinada pela variância do erro* $\sigma^2$". Portanto, há uma distribuição de valores de Y em cada x de forma que a variância da distribuição é constante em cada x.

### Condições

São assumidas algumas hipóteses sobre os dados de entrada na Regressão Linear:

1. Linearidade: a relação entre X e Y deve ser linear;

2. Homocedasticidade: a variância da variável dependente (Y) deve ser constante para todos os valores das variáveis independentes (X);

3. Normalidade: para um valor fixo de X, Y é uma variável aleatória com distribuição normal. Os resíduos também devem ser normalmente distribuídos;

3. Independência dos resíduo: como Yi e Yj são valores estatisticamente independentes (falta de correlação), os resíduos também deverão ser independentes.

4. Ausência de outliers influentes: não devem existir outliers que influenciem consideravelmente o modelo;


## Aplicação {-}

Para a aplicação serão utilizados dados de emissões dos gases de efeito estufa (GEE) por mudanças de cobertura da terra da Amazônia Legal disponibilizados pelo INPE (Instituto Nacional de Pesquisas Espaciais). Será representada a relação entre a área desmatada por ano e a emissão de 1ª ordem de $CO_2$ na Amazônia Legal.A estimativa de 1ª ordem supõe que, de modo simplificado, 100% das emissões ocorreram no momento da mudança de uso/cobertura.


```{r}
options("install.lock"=FALSE)

## Carregar pacotes que serão usados
if(!require(pacman)) install.packages("pacman")
library(pacman)

## Checando repositório
setwd("C:/Users/Luiz Arthur/Dropbox/PC/Documents/UFABC Beatriz/TG Beatriz Lima/Dados")

## Carregar base de dados
dados <- read.csv2("CO2Amazonia.csv")
View(dados)

# Verificando pressupostos para a regressão linear

## Relação linear entre a VD e a VI
plot(dados$D_Area, dados$VR_CO2_1stOrder)

## Construção do modelo
mod <- lm(VR_CO2_1stOrder ~ D_Area, dados, na.action = na.exclude)
summary(mod)


```

O r² (coeficiente de determinação) do modelo é 0,9975 e, portanto, pode-se interpretar que a variável área explica 99,75% da variação na emissão de $CO_2$.Dessa forma, conclui-se que o modelo possui bom ajuste.

O p-value do modelo apresenta valor $2.2e^{-16}$ e, assim, apresenta valor menor que o nível de significância (0,05), mostrando que existe alta probabilidade dos resultados apresentados pelo medelo não possuírem erro amostral.

De acordo com Montgomery e Runger (2021), "*A análise dos resíduos é frequentemente útil na verificação da suposição de que os erros sejam distribuídos de forma aproximadamente normal, com variância constante, assim como na determinação da utilidade dos termos adicionais no modelo*". Dessa forma, abaixo será realizada a análise residual.

```{r}
# Análise dos resíduos


par(mfrow=c(2,2)) 
plot(mod) ## Gráfico de regressão linear

```

Para a análise residual, é necessário investigar se os resíduos refletem as propriedades impostas pelo erro do modelo.
 
 - Residuals vs Fitted
 
  O gráfico mostra a relação entre os resíduos e os valores ajustados, ou seja, é possível verificar se resíduos tem padrões não-lineares. A distribuição dos resíduos próxima à linha pontilhada demonsta um bom ajuste do modelo.
 
 - Normal Q-Q
 
  O gráfico mostra se os resíduos são normalmente distribuídos. Mais uma vez, o ideal é que a distribuição dos resíduos acompanhe a linha pontilhada.
  
 - Scale-Location
 
  O gráfico mostra se os resíduos são igualmente distribuídos em relação ao intervalo de preditores (Fitted values).Também é possível checar a homocedasticidade. O ideal, no caso, seria que os resíduos estivessem uniformemente distribuídos ao redor da linha vermelha.
  
 - Residuals vs Leverage
 
  O gráfico ajuda na visualização de possíveis casos influentes, ou seja, outliers que influenciam na análise de regressão linear. O que quer dizer que, sem o outlier, o resultado da regressão seria diferente. 

Por fim, o resultado do modelo de regressão linear simples pode ser visualizado abaixo.

```{r}

#Diagrama de dispersão com o ajuste

plot(x = dados$D_Area, y = dados$VR_CO2_1stOrder, xlab = "Área desmatada no ano", ylab = "Emissão de CO2 de 1a ordem")

abline(mod, col = "blue")
```
